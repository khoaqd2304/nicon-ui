@model TopMenuModel
@using Nop.Web.Models.Catalog;

@helper RenderCategoryLine(CategorySimpleModel category, int level, bool responsiveMobileMenu)
{
    <li>
        <a href="@Url.RouteUrl("Category", new { SeName = category.SeName })">@category.Name
        @if (category.NumberOfProducts.HasValue)
        {
            <text> </text>@T("Categories.TotalProducts", category.NumberOfProducts.Value)
        }
        </a>
        @{
            //subcategories
            var subCategories = responsiveMobileMenu ?
                //responsive (all categories)
                category.SubCategories :
                //standard design (only categories with "IncludeInTopMenu")
                category.SubCategories.Where(x => x.IncludeInTopMenu).ToList();

            var levelClass = "";
            if (level == 0)
            {
                levelClass = "first-level";
            }
            if (subCategories.Count > 0)
            {


















                <div class="sublist-toggle"></div>
                <ul class="sublist @levelClass">
                    @foreach (var subCategory in subCategories)
                    {
                        @RenderCategoryLine(subCategory, level + 1, responsiveMobileMenu)
                    }
                </ul>
            }
        }
    </li>
}
    <ul class="menu clearfix">
        <li><a href="@Url.RouteUrl("HomePage")">@T("HomePage")</a></li>
        @{
        var rootCategories = Model.Categories.Where(x => x.IncludeInTopMenu).ToList();
        }
        @foreach (var category in rootCategories)
    {
        @RenderCategoryLine(category, 0, false)
}
        <li class="expanded color-default menu-depth-1 menu-item-1845">
            <a>@T("Profile")</a>
            <span class="menu_plus show-responsive"><a href="/en">menu plus</a></span>
            <ul class="menu clearfix">
                <li class="first leaf color-default menu-depth-2 menu-item-1763">
                    <a href="@Url.RouteUrl("DownloadFile")">@T("Catalogue")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("Strategy")">@T("Home.Strategy")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("OrganizationChart")">@T("Home.OrganizationChart")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("Certification")">@T("Home.Certification")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("ActivitiesHistory")">@T("Home.HistoryOfTheGroup")</a>
                </li>
                <li class="last leaf color-default menu-depth-2 menu-item-1762">
                   <a href="@Url.RouteUrl("AboutUs")">@T("Home.AboutUs")</a>
                </li>
            </ul>
        </li>
        <li class="expanded color-default menu-depth-1 menu-item-1845">
            <a>@T("Menu.Projects")</a>
            <span class="menu_plus show-responsive"><a href="/en">menu plus</a></span>
            <ul class="menu clearfix">
                <li class="first leaf color-default menu-depth-2 menu-item-1763">
                    <a href="@Url.RouteUrl("ProjectsUnderConstructionListMenu")">@T("Home.ProjectUnderConstruction")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("Construction")">@T("Home.Construction")</a>
                </li>
            </ul>
        </li>
        <li><a href="@Url.RouteUrl("Activities")">@T("Home.Activities")</a></li>
        <li><a href="@Url.RouteUrl("CustomerWork")">@T("Home.CustomerWork")</a></li>
        <li><a href="@Url.RouteUrl("Partner")">@T("Home.Partner")</a></li>
        <li><a href="@Url.RouteUrl("ContactUs")">@T("ContactUs")</a></li>
        @if (ViewBag.DetectMobile)
    {
        <li class="expanded color-default menu-depth-1 menu-item-1845">
            <a>@T("Service")</a>
            <span class="menu_plus show-responsive"><a href="/en">menu plus</a></span>
            <ul class="menu clearfix">
                <li class="first leaf color-default menu-depth-2 menu-item-1763">
                    <a href="@Url.RouteUrl("Service")">@T("homepage.services.designbuildcontractor")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("ListMainContractor")">@T("homepage.services.maincontractor")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("ListGeneralContractor")">@T("homepage.services.generalcontractor")</a>
                </li>
                <li class="first leaf color-default menu-depth-2 menu-item-1762">
                    <a href="@Url.RouteUrl("ListMEPContractor")">@T("homepage.services.mepcontractor")</a>
                </li>
            </ul>
        </li>
		<li><a href="~/news">@T("News")</a></li>
}

    </ul>
@{
    var rootCategoriesResponsive = Model.Categories.ToList();
    //name it "Categories" if we have only categories. Otherwise, "Menu"
    var responsiveMenuTitle = Model.HasOnlyCategories ? T("Categories") : T("Menu");
    <div class="menu-toggle">@responsiveMenuTitle</div>
    <ul class="top-menu mobile">
        @if (Model.DisplayHomePageMenuItem)
    {
        <li><a href="@Url.RouteUrl("HomePage")">@T("HomePage")</a></li>
}
        @foreach (var category in rootCategoriesResponsive)
    {
        @RenderCategoryLine(category, 0, true)
}
        @foreach (var topic in Model.Topics)
    {
        <li><a href="@Url.RouteUrl("Topic", new { SeName = topic.SeName })">@topic.Name</a></li>
}

        @if (Model.DisplayProductSearchMenuItem)
    {
        <li><a href="@Url.RouteUrl("ProductSearch")">@T("Search")</a></li>
}
        @if (Model.DisplayCustomerInfoMenuItem)
    {
        <li><a href="@Url.RouteUrl("CustomerInfo")">@T("Account.MyAccount")</a></li>
}
        @if (Model.BlogEnabled && Model.DisplayBlogMenuItem)
    {
        <li><a href="@Url.RouteUrl("Blog")">@T("Blog")</a></li>
}
        @if (Model.ForumEnabled && Model.DisplayForumsMenuItem)
    {
        <li><a href="@Url.RouteUrl("Boards")">@T("Forum.Forums")</a></li>
}
        @if (Model.DisplayContactUsMenuItem)
    {
        <li><a href="@Url.RouteUrl("ContactUs")">@T("ContactUs")</a></li>
}
        
    </ul>
    
    <script type="text/javascript">
        $(document).ready(function () {
            $(window).bind('scroll', function () {
                if ($(window).scrollTop() > 150) {
                    $('.region.region-highlighted .region-inner').addClass('fixed');
                } else {
                    $('.region.region-highlighted .region-inner').removeClass('fixed');
                }
            });
            $('.menu-toggle').click(function () {
                $(this).siblings('.top-menu.mobile').slideToggle('slow');
            });
            $('.top-menu.mobile .sublist-toggle').click(function () {
                $(this).siblings('.sublist').slideToggle('slow');
            });
        });
    </script>
}



