function loaddatalocation(){var n=$("#Location").val();n!=null&&n!=undefined&&n.length>0&&(_location=JSON.parse(n),loadlocation())}function searchmaps(){var t=document.getElementById("pac-input"),n=new google.maps.places.SearchBox(t);_map.controls[google.maps.ControlPosition.TOP_LEFT].push(t);_map.addListener("bounds_changed",function(){n.setBounds(_map.getBounds())});n.addListener("places_changed",function(){var i=n.getPlaces(),t;i.length!=0&&(clearMarkers(),t=new google.maps.LatLngBounds,console.log(i),i.forEach(function(n){if(!n.geometry){console.log("Returned place contains no geometry");return}var i={url:n.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};geocoderMarker(n.geometry.location.lat(),n.geometry.location.lng());n.geometry.viewport?t.union(n.geometry.viewport):t.extend(n.geometry.location)}),_map.fitBounds(t))})}function initMap(n,t){n==""||t==""?(t=106.6950374339599,n=10.774121190636265):(n=parseFloat(n),t=parseFloat(t));_map=new google.maps.Map(document.getElementById("map-api"),{zoom:5,center:{lat:n,lng:t}});geocoderMarker(n,t)}function geocoderMarker(n,t){var u=new google.maps.Geocoder,i=new google.maps.InfoWindow,r={lat:n,lng:t};u.geocode({location:r},function(n,t){t==="OK"&&n[0]&&(marker=new google.maps.Marker({map:_map,draggable:!0,animation:google.maps.Animation.DROP,position:r}),_map.zoom=5,_address=n[0].formatted_address,i.setContent(n[0].formatted_address),i.open(_map,marker),marker.addListener("dragend",toggleBounce))})}function clearMarkers(){marker.setMap(null);marker=[];_address=""}function toggleBounce(){marker.getAnimation()!==null&&marker.setAnimation(null);var n=this.position.lat(),t=this.position.lng();$("#lat").html(n);$("#long").html(t);clearMarkers();geocoderMarker(n,t)}function guid(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function loadlocation(){var n=$(".list-maps-location").empty();_location.length>0&&_location.forEach(function(t){n.append("<li class='"+t.Id+" margin-t-5'>"+t.Address+"<button class='btn bg-red btn-sm delete-maps' data-id='"+t.Id+"'><i class='fa fa-trash-o'><\/i>Delete<\/button><\/li>")})}function geocoding(n){return geocoder=new google.maps.Geocoder,(n==""||n==null)&&(n="Bình Định Việt Nam"),geocoder.geocode({address:n},function(n,t){if(t==google.maps.GeocoderStatus.OK){_map.setCenter(n[0].geometry.location);marker=new google.maps.Marker({map:_map,draggable:!0,animation:google.maps.Animation.DROP,position:n[0].geometry.location});marker.addListener("click",toggleBounce);var i=n[0].geometry.location.lat(),r=n[0].geometry.location.lng();$("#hidden-lat").val(i);$("#hidden-lng").val(r)}}),[]}function reverseGeocoding(n,t){geocoder=new google.maps.Geocoder;var i=new google.maps.InfoWindow,r={lat:parseFloat(n),lng:parseFloat(t)};geocoder.geocode({location:r},function(n,t){t==="OK"?n[1]?(_map.setZoom(15),marker.setMap(null),marker=new google.maps.Marker({map:_map,draggable:!0,animation:google.maps.Animation.DROP,position:{lat:10.793345,lng:106.68207699999994}}),marker.addListener("dragend",toggleBounce),i.setContent(n[1].formatted_address),i.open(_map,marker)):window.alert("No results found"):window.alert("Geocoder failed due to: "+t)})}function filladressauto(){var n="",r="",u="",f=$("#ProvinceId option:selected"),e=$("#DistrictId option:selected"),t,i,o;e.val()!=""&&(r=e.text());f.val()!=""&&(u="Việt Nam "+f.text());n=r+" "+u;t="";i="";n.trim!=" "&&($.trim(n),o=new google.maps.Geocoder,o.geocode({address:n},function(n,r){if(r==google.maps.GeocoderStatus.OK){t=n[0].geometry.location.lat();i=n[0].geometry.location.lng();initMap(t,i);return}}));initMap(t,i)}var geocoder,_map,marker,_address,_location=[];$(document).ready(function(){initMap("10.849975351131153","106.61510917532348");searchmaps();loaddatalocation()});$(document).on("click",".btn-add-location",function(){var n=marker.position.lat(),t=marker.position.lng(),i=!1;_location.forEach(function(r){r.Lat==n&&r.Log==t&&(i=!0)});i?alert("Location exits"):(_location.push({Id:guid(),Lat:n,Log:t,Address:_address}),loadlocation())});$(document).on("click",".delete-maps",function(){var n=$(this).data("id");n!=undefined&&n.length>0&&_location.forEach(function(t){t.Id==n&&_location.splice(t,1)});loadlocation()});$(document).on("click",".save-maps-location",function(){var n={Id:$("#Id").val(),IsActive:$("#IsActive").is(":checked"),Location:JSON.stringify(_location)};addAntiForgeryToken(n);$.ajax({cache:!1,type:"POST",url:"/Admin/Maps/SaveMaps",data:n,dataType:"json",success:function(n){n>0?MsgSuccess("Thông báo","Cập nhật thành công",3e3):MsgDanger("Thông báo","Lỗi cập nhật tin",3e3)},failure:function(n){MsgDanger("Thông báo","Lỗi cập nhật tin",3e3);console.log("Error:"+n)}})});